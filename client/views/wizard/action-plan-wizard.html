<div ng-controller="taskListCtrl">
    <div ng-controller="activitiesListCtrl">
        <div ng-controller="actionPlanCtrl">
            <div class="panel panel-default">
                <div class="panel-body">
                    <uib-tabset active="active">
                        <uib-tab index="0" heading="Step 1: Create Tasks" class="custom-tabs">
                            <br>
                            <div class="container-fluid">
                                <div class="row">
                                    <div class="col-md-12 col-sm-12 col-xs-12" st-pipe="tasksTable" st-table="tasks">
                                        <section class="panel panel-default">
                                            <div class="panel-body">
                                                <select st-input-event="change"
                                                        st-delay=0
                                                        class="form-control"
                                                        st-search="tags.text">
                                                    <option value="">
                                                        All Tags
                                                    </option>
                                                    <option ng-repeat="tag in tags" value="{{ tag.text }}">
                                                        {{ tag.text }}
                                                    </option>
                                                </select>
                                            </div>
                                        </section>

                                        <section class="panel panel-default">
                                            <div class="panel-heading">
                                                <strong>
                                                    <span class="glyphicon glyphicon-th">
                                                    </span> Task Library
                                                </strong>
                                                <div class="pull-right header-buttons">
                                                    <a ng-click="addModal();" class="btn btn-success btn-sm">Add Task</a>
                                                </div>
                                            </div>

                                            <div class="panel-body">
                                                <table class="table table-bordered table-striped table-responsive">
                                                    <thead>
                                                        <tr>
                                                            <th class="col-md-1" st-sort="title">Task Name</th>
                                                            <th class="col-md-2" st-sort="description">
                                                            Description</th>
                                                            <th class="col-md-1" st-sort="all_category.name">Category</th>
                                                            <th class="col-md-1" st-sort="tags.text">Tags</th>
                                                            <th class="col-md-1">Actions</th>
                                                        </tr>
                                                        <tr>
                                                            <th>
                                                                <input class="form-control" placeholder="Search Title" st-search="title" />
                                                            </th>
                                                            <th>
                                                                <input class="form-control" placeholder="Search Description" st-search="description" />
                                                            </th>
                                                            <th>
                                                                 <input class="form-control" placeholder="Search Category name" st-search="all_category.name" />
                                                            </th>
                                                            <th>
                                                                <input class="form-control" placeholder="Search Tags" st-search="tags.text" />
                                                            </th>
                                                            <th></th>
                                                        </tr>
                                                    </thead>
                                                    <tbody ng-show="!isLoading">
                                                        <tr ng-repeat="record in tasks">
                                                            <td>{{record.title}}</td>
                                                            <td>{{record.description}}</td>
                                                            <td>{{record.all_category.name}}</td>
                                                            <td><a href="" ng-repeat="tag in record.tags"> #{{tag.text}} </a> </td>
                                                            <td>
                                                                <a class="btn btn-sm btn-info" ng-click="EditFromWizard(record, $index)"><span class="glyphicon glyphicon-edit"></span></a>
                                                                <a class="btn btn-sm btn-danger" ng-click="deleteModal(record)"><span class="glyphicon glyphicon-remove-sign"></span></a>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                    <tbody ng-show="isLoading">
                                                        <tr>
                                                            <td colspan="4" class="text-center">Loading ... </td>
                                                        </tr>
                                                    </tbody>
                                                    <tfoot class="table table-striped table-responsive">
                                                        <tr>
                                                            <td class="text-center" st-pagination="" st-items-by-page="pageItems" colspan="7">
                                                            </td>
                                                        </tr>
                                                    </tfoot>
                                                </table>
                                                <div class="col-md-3">
                                                    <select class="form-control" ng-model="pageItems" ng-options="item.val as item.name for item in items" ng-selected="item.val === pageItems">
                                                    </select>
                                                </div>
                                            </div>
                                        </section>
                                    </div>
                                </div>
                            </div>
                        </uib-tab>

                        <uib-tab index="1" heading="Step 2: Assign Tasks" class="custom-tabs">
                            <br>
                            <div class="container-fluid">
                                <div class="row">
                                    <div class="col-md-12 col-sm-12 col-xs-12">

                                        <div ng-show="AssignedTasks" st-pipe="activitiesTable" st-table="activities">
                                            <section class="panel panel-default">
                                                <div class="panel-body">
                                                    <select st-input-event="change"
                                                            st-delay=0
                                                            class="form-control"
                                                            st-search="task_list.tags.text">
                                                        <option value="">
                                                            All Tags
                                                        </option>
                                                        <option ng-repeat="tag in tags" value="{{ tag.text }}">
                                                            {{ tag.text }}
                                                        </option>
                                                    </select>
                                                </div>
                                            </section>

                                            <section class="panel panel-default">
                                                <div class="panel-heading">
                                                    <strong>
                                                        <span class="glyphicon glyphicon-th"></span> Assigned Tasks
                                                    </strong>

                                                    <div style="display: inline-block;">
                                                        <div class="dropdown">
                                                            <button class="btn btn-primary btn-xs dropdown-toggle" type="button" data-toggle="dropdown" style="margin: 0;">Select Type
                                                                <span class="caret"></span></button>
                                                            <ul class="dropdown-menu">
                                                                <li>
                                                                    <a class="dropdown-cursor" role="menuitem" ng-click="unAssigned()"> UNASSIGNED</a>
                                                                    <a class="dropdown-cursor" role="menuitem" ng-click="assigned()"> Assigned</a>
                                                                </li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                    <div class="pull-right header-buttons">
                                                        <a href="" ng-click="createActivityWizard()" class="btn btn-success btn-sm">Assign Task</a>
                                                    </div>
                                                </div>
                                                <div class="panel-body">
                                                    <table class="table table-striped table-bordered">
                                                        <thead>
                                                        <tr>
                                                            <th st-sort="task_list.title">Task</th>
                                                            <th st-sort="responsibility_level">Responsibility Level</th>
                                                            <th st-sort="response_actor.firstName">Actor</th>
                                                            <th st-sort="Role.name">Role</th>
                                                            <th st-sort="department">
                                                                Department
                                                            </th>
                                                            <th st-sort="task_list.tags.text">Tags</th>
                                                            <th class="col-sm-2" >Actions</th>
                                                        </tr>

                                                        <tr>
                                                            <th>
                                                                <input class="form-control" placeholder="Search Task" st-search="task_list.title" />
                                                            </th>
                                                            <th>
                                                                <input class="form-control" placeholder="Search Responsibility Level" st-search="responsibility_level" />
                                                            </th>
                                                            <th>
                                                                <input class="form-control" placeholder="Search Actor" st-search="response_actor.firstName" />
                                                            </th>
                                                            <th>
                                                                <input class="form-control" placeholder="Search Role" st-search="role.name" />
                                                            </th>
                                                            <th>
                                                                <input class="form-control" placeholder="Search Department" st-search="department.name" />
                                                            </th>
                                                            <th>
                                                                <input class="form-control" placeholder="Search Tags" st-search="task_list.tags.text" />
                                                            </th>
                                                            <th></th>
                                                        </tr>
                                                        </thead>
                                                        <tbody ng-show="!isLoading">
                                                        <tr ng-repeat="activity in activities">
                                                            <td>{{activity.task_list.title}}</td>
                                                            <td>{{activity.responsibility_level}}</td>
                                                            <td>{{activity.response_actor.firstName}} {{activity.response_actor.lastName}}</td>
                                                            <td>{{activity.role.name}}</td>
                                                            <td>{{activity.department.name}}</td>
                                                            <td><a href="" ng-repeat="tag in activity.task_list.tags"> #{{tag.text}}</a> <br>
                                                            </td>
                                                            <td>
                                                                <button class="btn btn-sm btn-info"
                                                                        ng-click="editActivityWizard(activity,$index)">
                                                                    <span class="glyphicon glyphicon-edit"></span>
                                                                </button>
                                                                <button class="btn btn-sm btn-danger"
                                                                        confirm="Are you sure you want to delete?"
                                                                        ng-click="deleteActivityWizard(activity.id,$index)">
                                                                    <span class="glyphicon glyphicon-remove-sign"></span>
                                                                </button>
                                                            </td>
                                                        </tr>
                                                        </tbody>
                                                        <tbody ng-show="isLoading">
                                                        <tr>
                                                            <td colspan="4" class="text-center">Loading ... </td>
                                                        </tr>
                                                        </tbody>
                                                        <tfoot class="table table-striped table-responsive">
                                                        <tr>
                                                            <td class="text-center" st-pagination="" st-items-by-page="pageItems" colspan="7">
                                                            </td>
                                                        </tr>
                                                        </tfoot>
                                                    </table>
                                                    <div class="col-md-3">
                                                        <select class="form-control"
                                                                ng-model="pageItems"
                                                                ng-options="item.val as item.name for item in items"
                                                                ng-selected="item.val === pageItems">
                                                        </select>
                                                    </div>
                                                </div>
                                            </section>
                                        </div>

                                        <div ng-show="unassign" st-pipe="NottasksTable"  st-table="notAssigned">
                                            <section class="panel panel-default" ng-show="unassign">
                                                <div class="panel-body">
                                                    <select st-input-event="change"
                                                            st-delay=0
                                                            class="form-control"
                                                            st-search="tags.text">
                                                        <option value="">
                                                            All Tags
                                                        </option>
                                                        <option ng-repeat="tag in tags" value="{{ tag.text }}">
                                                            {{ tag.text }}
                                                        </option>
                                                    </select>
                                                </div>
                                            </section>

                                            <section class="panel panel-default">
                                                <div class="panel-heading">
                                                    <strong>
                                                        <span  class="glyphicon glyphicon-th"></span> Unassigned Tasks
                                                    </strong>
                                                    <div style="display: inline-block;">
                                                        <div class="dropdown">
                                                            <button class="btn btn-primary btn-xs dropdown-toggle" type="button" data-toggle="dropdown" style="margin: 0;">Select Type
                                                                <span class="caret"></span></button>
                                                            <ul class="dropdown-menu">
                                                                <li>
                                                                    <a class="dropdown-cursor" role="menuitem" ng-click="unAssigned()"> UNASSIGNED</a>
                                                                    <a class="dropdown-cursor" role="menuitem" ng-click="assigned()"> Assigned</a>
                                                                </li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                    <div class="pull-right header-buttons">
                                                        <a href="" ng-click="createActivityWizard()" class="btn btn-success btn-sm">Assign Task</a>
                                                    </div>
                                                </div>
                                                <div class="panel-body">
                                                    <table class="table table-bordered table-striped table-responsive">
                                                        <thead>
                                                        <tr>
                                                            <th class="col-md-1" st-sort="title">Title</th>
                                                            <th class="col-md-2" st-sort="description">Description</th>
                                                            <th class="col-md-1" st-sort="author">Author</th>
                                                            <th class="col-md-1" st-sort="tags.text">Tags</th>
                                                            <th class="col-md-2">Actions</th>
                                                        </tr>
                                                        <tr>
                                                            <th>
                                                                <input class="form-control"
                                                                       placeholder="Search Title"
                                                                       st-search="title"/>
                                                            </th>
                                                            <th>
                                                                <input class="form-control"
                                                                       placeholder="Search Description"
                                                                       st-search="description"/>
                                                            </th>
                                                            <th>
                                                                <input class="form-control"
                                                                       placeholder="Search Author"
                                                                       st-search="author"/>
                                                            </th>
                                                            <th>
                                                                <input class="form-control"
                                                                       placeholder="Search Tags"
                                                                       st-search="tags.text"/>
                                                            </th>
                                                            <th></th>
                                                        </tr>
                                                        </thead>
                                                        <tbody ng-show="!isLoading">
                                                        <tr ng-repeat="record in notAssigned">
                                                            <td>{{record.title}}</td>
                                                            <td>{{record.description}}</td>
                                                            <td>{{record.author}}</td>
                                                            <td><a href=""
                                                                   ng-repeat="texts in record.tags"> #{{texts.text}}</a>
                                                                <br>
                                                            </td>

                                                            <td> <a class="btn btn-info"
                                                                    ng-click="assignToActivity(record,$index)">Assign task
                                                            </a>
                                                            </td>
                                                        </tr>
                                                        </tbody>
                                                        <tbody ng-show="isLoading">
                                                        <tr>
                                                            <td colspan="4" class="text-center">Loading ... </td>
                                                        </tr>
                                                        </tbody>
                                                        <tfoot class="table table-striped table-responsive">
                                                        <tr>
                                                            <td class="text-center"
                                                                st-pagination=""
                                                                st-items-by-page="pageItems"
                                                                colspan="7">
                                                            </td>
                                                        </tr>
                                                        </tfoot>
                                                    </table>

                                                    <div class="col-md-3">
                                                        <select class="form-control"
                                                                ng-model="pageItems"
                                                                ng-options="item.val as item.name for item in items"
                                                                ng-selected="item.val === pageItems">
                                                        </select>
                                                    </div>
                                                </div>
                                            </section>
                                        </div>

                                    </div>
                                </div>
                            </div>
                        </uib-tab>

                        <uib-tab index="2" heading="Step 3: Build Action Plan" class="custom-tabs">
                            <br>
                            <div class="container-fluid">
                                <div class="row">
                                    <div class="col-md-12 col-sm-12 col-xs-12">
                                        <section class="panel panel-default">
                                            <div class="panel-heading">
                                                <strong>
                                                    <span class="glyphicon glyphicon-th"></span> Action Plan Library
                                                </strong>

                                                <div class="pull-right header-buttons">
                                                    <a ng-click="createNewActionPlan()" class="btn btn-success btn-sm">
                                                        Build Action Plan
                                                    </a>
                                                </div>

                                                <div class="pull-right header-buttons">
                                                    <a ng-click="createSectionPlan()" class="btn btn-success btn-sm">
                                                        Build Action Plan V2
                                                    </a>
                                                </div>
                                            </div>
                                            <div class="panel-body">
                                                    <table  st-pipe="planTable" st-table="plans" class="table table-bordered table-striped table-responsive">
                                                        <thead>
                                                            <tr>
                                                                <th class="col-md-2" st-sort="name">Name</th>
                                                                <th class="col-md-2" st-sort>Incident Type</th>
                                                                <th class="col-md-1" st-sort="scenario"> Scenario</th>
                                                                <th class="col-md-2" st-sort="description"> Description</th>
                                                                <th class="col-md-1" st-sort="createdAt"> Date Created</th>
                                                                <th class="col-md-3"> Actions</th>
                                                            </tr>
                                                            <th>
                                                            <input class="form-control" placeholder="Search Name" st-search="name"/>
                                                          </th>
                                                          <th>
                                                              <input class="form-control" placeholder="Search Type"
                                                              st-search="type"/>
                                                          </th>
                                                          <th>
                                                              <input class="form-control" placeholder="Search Scenario"
                                                              st-search="scenario"/>
                                                          </th>
                                                          <th>
                                                              <input class="form-control" placeholder="Search Description"
                                                              st-search="Description"/>
                                                          </th>
                                                          <th>
                                                              <input class="form-control" placeholder="Search Date"
                                                              st-search="createdAt"/>
                                                          </th>
                                                          <th></th>
                                                        </thead>
                                                        <tbody>
                                                            <tr ng-repeat="plan in plans">
                                                                <td>{{plan.name}}</td>
                                                                <td>{{plan.type}}</td>
                                                                <td>{{plan.scenario}}</td>
                                                                <td>{{plan.description}}</td>
                                                                <td>{{ plan.createdAt | date: 'HH:mm dd-MM-yyyy' }}</td>
                                                                <td>
                                                                    <button title="View Plan" class="btn btn-sm btn-primary" ng-click="viewPlan(plan.id)">
                                                                        <span class="fa fa-television"></span>
                                                                    </button>

                                                                    <button title="Edit Plan" ng-click="editModal(plan)" class="btn btn-sm btn-success">
                                                                        <span class="glyphicon glyphicon-edit"></span>
                                                                    </button>

                                                                    <button title="Edit Plan V2" ng-click="editNewPlan(plan.id)" class="btn btn-sm btn-success">
                                                                        <span class="glyphicon glyphicon-copyright-mark"></span>
                                                                    </button>

                                                                    <button title="Copy Plan" class="btn btn-sm btn-primary" ng-click="clonePlan(plan)">
                                                                        <span class="glyphicon glyphicon-floppy-open"></span>
                                                                    </button>

                                                                    <button title="Delete Plan" class="btn btn-sm btn-danger" ng-click="delete($index,plan.id)" confirm = "Are you sure to DELETE '{{plan.name}}' ?">
                                                                        <span class="glyphicon glyphicon-remove-sign"></span>
                                                                    </button>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                        <tbody ng-show="isLoading">
                                                          <tr>
                                                            <td colspan="4" class="text-center">Loading ... </td>
                                                        </tr>
                                                    </tbody>
                                                    <tfoot class="table table-striped table-responsive">
                                                      <tr>
                                                        <td class="text-center" st-pagination="" st-items-by-page="pageItems" colspan="7">
                                                        </td>
                                                    </tr>
                                                </tfoot>
                                            </table>
                                            <div class="col-md-3">
                                              <select class="form-control"
                                              ng-model="pageItems"
                                              ng-options="item.val as item.name for item in items"
                                              ng-selected="item.val === pageItems">
                                          </select>
                                      </div>
                                            </div>
                                        </section>
                                    </div>
                                </div>
                            </div>
                        </uib-tab>
                    </uib-tabset>
                </div>
            </div>
        </div>
    </div>
</div>
